<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>حساب الخزائن والحلق مع جدول النتائج</title>
<style>
body { font-family: "Tahoma", sans-serif; direction: rtl; margin: 20px; }
h2 { color: #333; }
.container { display: flex; gap: 20px; flex-wrap: wrap; }
.section { border: 1px solid #aaa; padding: 15px; border-radius: 8px; width: 48%; min-width: 300px;}
label { display: block; margin-top: 10px; }
input { width: 100px; margin-top: 5px; }
button { margin-top: 10px; padding: 5px 15px; cursor: pointer; }
.results { margin-top: 20px; background: #f9f9f9; padding: 15px; border-radius: 8px; overflow-x:auto; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #aaa; padding: 6px; text-align: center; }
th { background: #f0f0f0; }
.divider-row { display: flex; gap: 5px; align-items: center; margin-top:5px; }
.divider-row input, .divider-row select { width: 60px; }
.remove-btn { background:#e03131;color:#fff;border:0;border-radius:4px;padding:2px 6px;cursor:pointer; }
</style>
</head>
<body>

<h2>📐 برنامج حساب الخزائن والحلق مع جدول النتائج</h2>

<div class="container">
  <!-- خزانة -->
  <div class="section">
    <h3>➕ إضافة خزانة</h3>
    <label>العرض (سم): <input type="number" id="cabWidth"></label>
    <label>الارتفاع (سم): <input type="number" id="cabHeight"></label>
    <label>العمق (سم): <input type="number" id="cabDepth"></label>
    <label>عدد الأبواب:
      <select id="cabDoors">
        <option value="1">باب واحد</option>
        <option value="2">بابان</option>
      </select>
    </label>
    <button onclick="addCabinet()">إضافة خزانة</button>
  </div>

  <!-- حلق -->
  <div class="section">
    <h3>➕ إضافة حلق سفلي</h3>
    <label>العرض (سم): <input type="number" id="frameWidth"></label>
    <label>الارتفاع (سم): <input type="number" id="frameHeight"></label>
    <div id="dividersContainer"></div>
    <button onclick="addDivider()">➕ إضافة قاطع</button>
    <button onclick="addFrame()">إضافة حلق</button>
  </div>
</div>

<div class="results" id="results">
  <h3>📊 النتائج:</h3>
</div>

<div style="margin-top: 15px;">
  <button onclick="showSummary()">📝 عرض الملخص النهائي</button>
  <button onclick="window.print()">🖨️ طباعة النتائج</button>
</div>

<script>
let resultsDiv = document.getElementById("results");
let summary = {doors:0, hinges:0, handles:0, corners:0};
let dividerIndex = 0;

// إضافة خزانة
function addCabinet() {
  let wMain = parseFloat(document.getElementById("cabWidth").value);
  let hMain = parseFloat(document.getElementById("cabHeight").value);
  let dMain = parseFloat(document.getElementById("cabDepth").value);
  let doors = parseInt(document.getElementById("cabDoors").value);

  if (wMain<=0 || hMain<=0 || dMain<=0){ alert("❌ أدخل قياسات صحيحة للخزانة"); return; }

  let w = wMain - 5, h = hMain -5, d = dMain -5;
  let cabCorners=0;
  let doorRows = [];
  if(doors===1){
    let doorW = wMain -3, doorH = hMain -2.5;
    doorRows.push({width:doorW,height:doorH,doors:1,hinges:2,handles:1,corners:4});
    cabCorners=4;
  } else {
    let doorW = (wMain -4)/2, doorH = hMain -2.5;
    doorRows.push({width:doorW,height:doorH,doors:2,hinges:4,handles:2,corners:8});
    cabCorners=8;
  }

  summary.doors += doorRows.reduce((s,r)=>s+r.doors,0);
  summary.hinges += doorRows.reduce((s,r)=>s+r.hinges,0);
  summary.handles += doorRows.reduce((s,r)=>s+r.handles,0);
  summary.corners += cabCorners;

  let table = `<table>
  <tr><th colspan="2">🗄️ خزانة</th></tr>
  <tr><td>البروفيلات</td><td>
    ارتفاع: 2×${h} (بسنين) + 2×${h} (بسن واحد)<br>
    عرض: 2×${w} (بسنين) + 2×${w} (بسن واحد)<br>
    عمق: 4×${d} (بسنين)
  </td></tr>
  <tr><th>الأبواب</th><th>القياسات / عدد الفصالات / الأيدي / الزوايا</th></tr>`;

  doorRows.forEach((r,i)=>{
    table+=`<tr><td>باب ${i+1}</td><td>${r.width}×${r.height} — فصالات ${r.hinges} / يد ${r.handles} — زوايا ${r.corners}</td></tr>`;
  });

  table+=`</table>`;
  resultsDiv.innerHTML += table;
}

// إضافة قاطع
function addDivider() {
  dividerIndex++;
  const container = document.getElementById("dividersContainer");
  const row = document.createElement("div");
  row.className="divider-row";
  row.dataset.index=dividerIndex;
  row.innerHTML = `
    مسافة (سم): <input type="number" class="dividerDistance" value="0">
    عدد أبواب: <select class="dividerDoors"><option value="1">1</option><option value="2">2</option></select>
    <button class="remove-btn" onclick="this.parentElement.remove()">×</button>
  `;
  container.appendChild(row);
}

// إضافة حلق
function addFrame() {
  let w = parseFloat(document.getElementById("frameWidth").value);
  let h = parseFloat(document.getElementById("frameHeight").value);
  if(w<=0||h<=0){alert("❌ أدخل قياسات صحيحة للحلق"); return;}

  const divRows = Array.from(document.querySelectorAll("#dividersContainer .divider-row"));
  const N = divRows.length;
  const innerAvailable = w - N*2.7; // خصم عرض القواطع
  let distances = divRows.map(r=>parseFloat(r.querySelector(".dividerDistance").value)||0);
  let distancesSum = distances.reduce((s,x)=>s+x,0);

  let table = `<table><tr><th colspan="2">🚪 حلق سفلي</th></tr>
               <tr><td>الأبعاد</td><td>عرض ${w} × ارتفاع ${h}</td></tr>
               <tr><th>المقطع</th><th>قياسات / فصالات / الأيدي / الزوايا</th></tr>`;

  if(distancesSum>innerAvailable){
    table+=`<tr><td colspan="2" style="color:red">خطأ: مجموع مسافات القواطع (${distancesSum}) أكبر من المساحة الداخلية المتاحة (${innerAvailable})</td></tr>`;
  } else {
    const segments = distances.slice();
    segments.push(innerAvailable - distancesSum);
    segments.forEach((segWidth,idx)=>{
      const doorsCount = (idx<divRows.length)?parseInt(divRows[idx].querySelector(".dividerDoors").value):1;
      let doorW = (doorsCount===1)?segWidth-3:(segWidth-0)/doorsCount-2.5;
      let doorH = h-2.5;
      let corners = doorsCount===1?4:8;
      let hinges = doorsCount===1?2:4;
      let handles = doorsCount===1?1:2;

      summary.doors += doorsCount;
      summary.hinges += hinges;
      summary.handles += handles;
      summary.corners += corners;

      table+=`<tr><td>المقطع ${idx+1}</td><td>${doorW.toFixed(2)} × ${doorH} — فصالات ${hinges} / يد ${handles} — زوايا ${corners}</td></tr>`;
    });
  }

  table+=`</table>`;
  resultsDiv.innerHTML += table;

  document.getElementById("dividersContainer").innerHTML="";
  dividerIndex=0;
}

// الملخص النهائي
function showSummary(){
  let table = `<table>
  <tr><th>ملخص</th><th>القيمة</th></tr>
  <tr><td>مجموع الأبواب</td><td>${summary.doors}</td></tr>
  <tr><td>مجموع الفصالات</td><td>${summary.hinges}</td></tr>
  <tr><td>مجموع الأيدي</td><td>${summary.handles}</td></tr>
  <tr><td>مجموع الزوايا</td><td>${summary.corners}</td></tr>
  </table>`;
  resultsDiv.innerHTML += table;
}
</script>

</body>
</html>
