<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø®Ø²Ø§Ø¦Ù† ÙˆØ§Ù„Ø­Ù„Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ â€” Ù†Ù‡Ø§Ø¦ÙŠØ©</title>
<style>
body{font-family:"Segoe UI", Tahoma, Geneva, Verdana, sans-serif;background:#f3f4f6;margin:0;padding:18px;}
.container{max-width:1200px;margin:0 auto;background:white;padding:20px;border-radius:10px;box-shadow:0 6px 20px rgba(0,0,0,0.08);}
h1{text-align:center;color:#0b5ed7}
.panel-row{display:flex;gap:18px;flex-wrap:wrap;margin-bottom:12px}
.card{flex:1 1 320px;background:#fbfdff;border:1px solid #e6eefc;padding:14px;border-radius:10px;}
label{display:block;margin-top:8px;font-weight:600}
input[type="number"], select{width:100%;padding:8px;border-radius:6px;border:1px solid #cbd5e1;margin-top:6px}
.small{font-size:13px;color:#555;margin-top:6px}
.btn{display:inline-block;padding:10px 14px;margin-top:12px;border-radius:8px;border:0;cursor:pointer;background:#0b5ed7;color:#fff}
.btn.secondary{background:#0d6efd77}
.btn.danger{background:#e03131}
.divider-row{display:flex;gap:8px;align-items:center;margin-top:8px}
.divider-row input, .divider-row select{width:48%}
.results{margin-top:20px}
.result-item{background:#f8fafc;border:1px solid #e6eefc;padding:12px;border-radius:8px;margin-bottom:12px}
.error{color:#b91c1c;font-weight:700}
.muted{color:#475569;font-size:14px}
.inline{display:inline-block;margin-left:8px}
.remove-small{background:#ef4444;color:#fff;border:0;padding:6px 8px;border-radius:6px;cursor:pointer}
</style>
</head>
<body>
<div class="container">
<h1>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø®Ø²Ø§Ø¦Ù† ÙˆØ§Ù„Ø­Ù„Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ</h1>

<div class="panel-row">
  <div class="card" id="cabinetsPanel">
    <h3>Ø§Ù„Ø®Ø²Ø§Ø¦Ù†</h3>
    <div id="cabinetsContainer"></div>
    <button class="btn" id="addCabinetBtn">â• Ø¥Ø¶Ø§ÙØ© Ø®Ø²Ø§Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
    <p class="small muted">ÙƒÙ„ Ø®Ø²Ø§Ù†Ø©: Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙˆØ§Ù„Ø¹Ù…Ù‚ ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨. Ø§Ù„Ø­Ø³Ø§Ø¨ ÙŠÙ†Ù‚Øµ 5 Ø³Ù… Ù„ÙƒÙ„ Ø¨Ø±ÙˆÙÙŠÙ„.</p>
  </div>

  <div class="card" id="basesPanel">
    <h3>Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ø³ÙÙ„ÙŠ</h3>
    <div id="basesContainer"></div>
    <button class="btn" id="addBaseBtn">â• Ø¥Ø¶Ø§ÙØ© Ø­Ù„Ù‚ Ø³ÙÙ„ÙŠ Ø¬Ø¯ÙŠØ¯</button>
    <p class="small muted">Ù„ÙƒÙ„ Ø­Ù„Ù‚: Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø§Ø±ØªÙØ§Ø¹ØŒ Ø£Ø¶Ù Ù‚ÙˆØ§Ø·Ø¹ØŒ ÙˆØ­Ø¯Ø¯ Ø¹Ø¯Ø¯ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.</p>
  </div>
</div>

<div style="text-align:center">
  <button class="btn" id="calculateBtn">ğŸ“Š Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</button>
</div>

<div class="results" id="results"></div>
</div>

<script>
const PROFILE_WIDTH = 5;
const CUTTER_WIDTH = 5;

let cabinetCount = 0;
let baseCount = 0;

document.getElementById('addCabinetBtn').addEventListener('click', () => {
  cabinetCount++;
  const cont = document.getElementById('cabinetsContainer');
  const wrapper = document.createElement('div');
  wrapper.className = 'element-container';
  wrapper.id = `cabinet${cabinetCount}`;
  wrapper.style.marginBottom = '12px';
  wrapper.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Ø®Ø²Ø§Ù†Ø© ${cabinetCount}</strong>
      <button class="remove-small" onclick="removeCabinet(${cabinetCount})">Ø­Ø°Ù</button>
    </div>
    <label>Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø²Ø§Ù†Ø© (Ø³Ù…)</label>
    <input type="number" class="cabWidth" placeholder="Ù…Ø«Ø§Ù„: 120">
    <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø®Ø²Ø§Ù†Ø© (Ø³Ù…)</label>
    <input type="number" class="cabHeight" placeholder="Ù…Ø«Ø§Ù„: 80">
    <label>Ø¹Ù…Ù‚ Ø§Ù„Ø®Ø²Ø§Ù†Ø© (Ø³Ù…)</label>
    <input type="number" class="cabDepth" placeholder="Ù…Ø«Ø§Ù„: 60">
    <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨</label>
    <select class="cabDoors">
      <option value="1">Ø¨Ø§Ø¨ ÙˆØ§Ø­Ø¯</option>
      <option value="2">Ø¨Ø§Ø¨Ø§Ù†</option>
    </select>
  `;
  cont.appendChild(wrapper);
});

document.getElementById('addBaseBtn').addEventListener('click', () => {
  baseCount++;
  const cont = document.getElementById('basesContainer');
  const wrapper = document.createElement('div');
  wrapper.className = 'element-container';
  wrapper.id = `base${baseCount}`;
  wrapper.style.marginBottom = '12px';
  wrapper.innerHTML = `
    <div style="display:flex;justify-content:space-between;align-items:center">
      <strong>Ø§Ù„Ø­Ù„Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ ${baseCount}</strong>
      <button class="remove-small" onclick="removeBase(${baseCount})">Ø­Ø°Ù</button>
    </div>
    <label>Ø¹Ø±Ø¶ Ø§Ù„Ø­Ù„Ù‚ (Ø³Ù…)</label>
    <input type="number" class="baseWidth" placeholder="Ù…Ø«Ø§Ù„: 240">
    <label>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ø­Ù„Ù‚ (Ø³Ù…)</label>
    <input type="number" class="baseHeight" placeholder="Ù…Ø«Ø§Ù„: 50">
    <div class="dividersContainer"></div>
    <button type="button" class="btn secondary" style="margin-top:10px" onclick="addDivider(${baseCount})">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ø§Ø·Ø¹</button>
    <label style="margin-top:8px">Ø¹Ø¯Ø¯ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</label>
    <select class="baseDoors">
      <option value="1">Ø¨Ø§Ø¨ ÙˆØ§Ø­Ø¯</option>
      <option value="2">Ø¨Ø§Ø¨Ø§Ù†</option>
    </select>
  `;
  cont.appendChild(wrapper);
});

function removeCabinet(id){ const el=document.getElementById('cabinet'+id); if(el) el.remove();}
function removeBase(id){ const el=document.getElementById('base'+id); if(el) el.remove();}

function addDivider(baseId){
  const baseDiv = document.getElementById('base'+baseId);
  if(!baseDiv) return;
  const container = baseDiv.querySelector('.dividersContainer');
  const idx = container.children.length + 1;
  const row = document.createElement('div');
  row.className = 'divider-row';
  row.dataset.index = idx;
  row.innerHTML = `
    <input type="number" class="dividerInput" placeholder="Ù…Ø³Ø§ÙØ© Ø§Ù„Ù‚Ø§Ø·Ø¹ ${idx} (Ø³Ù…) Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©/Ø§Ù„Ù‚Ø§Ø·Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚">
    <select class="dividerDoors">
      <option value="1">Ø¹Ø¯Ø¯ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚: 1</option>
      <option value="2">Ø¹Ø¯Ø¯ Ø£Ø¨ÙˆØ§Ø¨ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚: 2</option>
    </select>
    <button class="remove-small" style="height:36px" onclick="this.parentElement.remove()">Ã—</button>
  `;
  container.appendChild(row);
}

document.getElementById('calculateBtn').addEventListener('click', () => {
  const results = document.getElementById('results');
  results.innerHTML = '';

  // Ø®Ø²Ø§Ø¦Ù†
  const cabinetEls = Array.from(document.querySelectorAll('[id^="cabinet"]'));
  cabinetEls.forEach((cabEl, idx) => {
    const w=parseFloat(cabEl.querySelector('.cabWidth')?.value) || 0;
    const h=parseFloat(cabEl.querySelector('.cabHeight')?.value) || 0;
    const d=parseFloat(cabEl.querySelector('.cabDepth')?.value) || 0;
    if(w<=0||h<=0||d<=0) return; // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„ÙØ§Ø±ØºØ©
    const doors = parseInt(cabEl.querySelector('.cabDoors')?.value) || 1;

    const wAdj = +(w-5).toFixed(2);
    const hAdj = +(h-5).toFixed(2);
    const dAdj = +(d-5).toFixed(2);

    let doorDetails='';
    let totalDoors=0, totalHinges=0, totalHandles=0;
    if(doors===1){
      const doorH=+(hAdj-3).toFixed(2);
      const doorW=+(wAdj-3).toFixed(2);
      totalDoors=1; totalHinges=2; totalHandles=1;
      doorDetails+=`<div>Ø¨Ø§Ø¨ ÙˆØ§Ø­Ø¯ â€” Ø¹Ø±Ø¶ ${doorW} Ø³Ù… Ã— Ø§Ø±ØªÙØ§Ø¹ ${doorH} Ø³Ù… â€” ÙØµØ§Ù„Ø§Øª 2 / ÙŠØ¯ 1</div>`;
    } else {
      const doorH=+(hAdj-3).toFixed(2);
      const doorW=+(((wAdj-2.5)/2).toFixed(2));
      totalDoors=2; totalHinges=4; totalHandles=2;
      doorDetails+=`<div>Ø¨Ø§Ø¨Ø§Ù† â€” Ù„ÙƒÙ„ Ø¨Ø§Ø¨ Ø¹Ø±Ø¶ ${doorW} Ø³Ù… Ã— Ø§Ø±ØªÙØ§Ø¹ ${doorH} Ø³Ù… â€” ÙØµØ§Ù„Ø§Øª 2 / ÙŠØ¯ 1</div>`;
    }

    const html=document.createElement('div');
    html.className='result-item';
    html.innerHTML=`
      <strong>Ø®Ø²Ø§Ù†Ø© ${idx+1}</strong>
      <div class="muted">Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø§Ù„Ø£ØµÙ„ÙŠØ©: Ø¹Ø±Ø¶ ${w} Ø³Ù… Ã— Ø§Ø±ØªÙØ§Ø¹ ${h} Ø³Ù… Ã— Ø¹Ù…Ù‚ ${d} Ø³Ù…</div>
      <div class="muted">Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ Ø¨Ø¹Ø¯ Ø®ØµÙ… 5 Ø³Ù…: Ø¹Ø±Ø¶ ${wAdj} Ø³Ù… Ã— Ø§Ø±ØªÙØ§Ø¹ ${hAdj} Ø³Ù… Ã— Ø¹Ù…Ù‚ ${dAdj} Ø³Ù…</div>
      <div style="margin-top:8px"><strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨:</strong></div>
      ${doorDetails}
      <div style="margin-top:8px" class="muted">Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${totalHandles} â€” Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØµØ§Ù„Ø§Øª: ${totalHinges}</div>
    `;
    results.appendChild(html);
  });

  // Ø­Ù„Ù‚Ø§Øª
  const baseEls = Array.from(document.querySelectorAll('[id^="base"]'));
  baseEls.forEach((baseEl, idx) => {
    const wRaw=parseFloat(baseEl.querySelector('.baseWidth')?.value)||0;
    const hRaw=parseFloat(baseEl.querySelector('.baseHeight')?.value)||0;
    if(wRaw<=0||hRaw<=0) return;
    const finalDoors=parseInt(baseEl.querySelector('.baseDoors')?.value)||1;

    const divRows=Array.from(baseEl.querySelectorAll('.dividersContainer .divider-row'));
    const N=divRows.length;
    const innerAvailable=+(wRaw-2*PROFILE_WIDTH-N*CUTTER_WIDTH).toFixed(6);
    const distances=divRows.map(r=>parseFloat(r.querySelector('.dividerInput')?.value)||0);
    const distancesSum=distances.reduce((a,b)=>a+b,0);

    const resultCard=document.createElement('div');
    resultCard.className='result-item';
    resultCard.innerHTML=`<strong>Ø§Ù„Ø­Ù„Ù‚ Ø§Ù„Ø³ÙÙ„ÙŠ ${idx+1}</strong>
      <div class="muted">Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯: Ø¹Ø±Ø¶ ${wRaw} Ã— Ø§Ø±ØªÙØ§Ø¹ ${hRaw}</div>`;

    if(distancesSum>innerAvailable+1e-9){
      resultCard.innerHTML+=`<div class="error">Ø®Ø·Ø£: Ù…Ø¬Ù…ÙˆØ¹ Ù…Ø³Ø§ÙØ§Øª Ø§Ù„Ù‚ÙˆØ§Ø·Ø¹ (${distancesSum} Ø³Ù…) Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© (${innerAvailable} Ø³Ù…)</div>`;
      results.appendChild(resultCard);
      return;
    }

    const remaining=+(innerAvailable-distancesSum).toFixed(6);
    const segments=distances.slice(); segments.push(remaining);

    const doorsPerSegment=[];
    for(let s=0;s<segments.length;s++){
      if(s<divRows.length){
        doorsPerSegment.push(parseInt(divRows[s].querySelector('.dividerDoors')?.value)||1);
      } else { doorsPerSegment.push(finalDoors); }
    }

    let totalDoors=0, totalHinges=0, totalHandles=0;
    resultCard.innerHTML+=`<div style="margin-top:8px"><strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø·Ø¹:</strong></div>`;
    segments.forEach((segWidth,segIdx)=>{
      const doorsCount=doorsPerSegment[segIdx];
      const doorHeight=+(hRaw-3).toFixed(2);
      if(doorsCount===1){
        const doorW=+(segWidth-3).toFixed(2);
        resultCard.innerHTML+=`<div>Ø§Ù„Ù…Ù‚Ø·Ø¹ ${segIdx+1}: Ø¨Ø§Ø¨ ÙˆØ§Ø­Ø¯: Ø¹Ø±Ø¶ ${doorW} Ã— Ø§Ø±ØªÙØ§Ø¹ ${doorHeight} â€” ÙØµØ§Ù„Ø§Øª 2 / ÙŠØ¯ 1</div>`;
        totalDoors+=1; totalHinges+=2; totalHandles+=1;
      } else {
        const perDoorW=+((segWidth-2.5)/2).toFixed(2);
        resultCard.innerHTML+=`<div>Ø§Ù„Ù…Ù‚Ø·Ø¹ ${segIdx+1}: Ø¨Ø§Ø¨Ø§Ù† Ù„ÙƒÙ„ Ø¨Ø§Ø¨ ${perDoorW} Ã— ${doorHeight} â€” ÙØµØ§Ù„Ø§Øª 2 / ÙŠØ¯ 1</div>`;
        totalDoors+=2; totalHinges+=4; totalHandles+=2;
      }
    });
    resultCard.innerHTML+=`<div style="margin-top:8px" class="muted">Ù…Ù„Ø®Øµ Ø§Ù„Ø­Ù„Ù‚ ${idx+1}: Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£Ø¨ÙˆØ§Ø¨: ${totalDoors} â€” Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØµØ§Ù„Ø§Øª: ${totalHinges} â€” Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø£ÙŠØ¯ÙŠ: ${totalHandles}</div>`;
    results.appendChild(resultCard);
  });
});
</script>
</body>
</html>
